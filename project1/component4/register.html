<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>REGISTRATION</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div class="main">
      <h3 class="mb-5">sign up</h3>
      <input
        type="text"
        placeholder="full name"
        id="nameInp"
        class="form-control mb-3"
      />
      <input
        type="text"
        placeholder="Email"
        id="EmailInp"
        class="form-control mb-3"
      />
      <input
        type="text"
        placeholder="user name"
        id="userInp"
        class="form-control mb-3"
      />
      <input
        type="password"
        placeholder="password"
        id="passInp"
        class="form-control mb-3"
      />
      <button
        type="submit"
        id="sub-btn"
        class="btn btn-outline-primary mb-3 w-100"
      >
        sign up
      </button>
      <a href="login.html" class="badge badge-secondary py-1 w-100"
        >already have an account?</a
      >
    </div>

    <script type="module">
              // Import the functions you need from the SDKs you need
              import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";

              const firebaseConfig = {
                apiKey: "AIzaSyAmBiucX_jveVMzEMx-s98fP48wDrE4j-E",
                authDomain: "my-new-project-f40ef.firebaseapp.com",
                projectId: "my-new-project-f40ef",
                storageBucket: "my-new-project-f40ef.appspot.com",
                messagingSenderId: "1070087609490",
                appId: "1:1070087609490:web:17fcf8bca8e8ae88ec9a4b"
              };

              // Initialize Firebase
              const app = initializeApp(firebaseConfig);

              import{ getDatabase, ref, set, child, get}
              from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

              const db = getDatabase();

              // THE REFERENCES

              const name =document.getElementById('nameInp');
              const email =document.getElementById('emailInp');
              const user =document.getElementById('userInp');
              const pass =document.getElementById('passInp');
              const submit =document.getElementById('sub-btn');


              //VALIDATION




              function validation(){
                  let nameregex= /^[a-zA-Z]+$/;
                  let emailregex = /^[a-zA-Z0-9]+ @\.(gmail|yahoo|outlook)\.com$/
                  let userregex = /^[a-zA-Z0-9]{5,}$/;
                  let passregex = /^[a-zA-Z0-9]{6,}$/;

                  if(!nameregex.test(name.value)){
                      alert ("the name should only conntain alphabets!");
                      return false;

                  }

                  if(!emailregex.test(email.value)){
                      alert ("enter a valid email");
                      return false;
              }

              if(!userregex.test(username.value)){
                  alert ("username should only conntain alphabetnumeric\n-username must be at least 5 characters\n-username cannot contain spaces!");
                return false;

          }
          return true;
      }

      // REGISTER USER TO FIREBASE
      function RegisterUser(){
          if(!validation()){
            return;
          };
          const dbRef =ref(db);
          get (child( dbRef, "UserList/"+ username.value)).thenn((snapshot)=>{
      if(snapshot.exists()){
          alert("account already exist!");
      }
      else{
      set(ref(db, "userList/"+ username.value),
      {
      fullname: name.value,
      email: email.value,
      usernmae: username.value,
      password: pass.value
      
          })
          
.then(() =>{
    alert("user added successfully");
              })
                    
.catch((error)=>{
    alert("error" + error);
          })
        }
    });
}

// ASSIGN THE EVENTS

submit.addEventListener('click', RegisterUser);

    </script>
  </body>
</html>
   